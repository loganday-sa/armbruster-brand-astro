---
import type { CollectionEntry } from 'astro:content';
import FormattedDate from './FormattedDate.astro';
import { getCategoryConfig, getCategoryPath, getReadingTime } from '../consts';

interface Props {
	post: CollectionEntry<'blog'>;
	showCategory?: boolean;
}

const { post, showCategory = true } = Astro.props;
const catConfig = getCategoryConfig(post.data.category);
const postUrl = `${getCategoryPath(post.data.category)}${post.slug}/`;
const readingTime = getReadingTime(post.body);
---

<article class="bg-slate-900 border border-slate-800 rounded-xl overflow-hidden hover:border-slate-700 transition group">
	<a href={postUrl} class="block">
		{post.data.heroImage ? (
			<div class="aspect-video overflow-hidden">
				<img
					src={post.data.heroImage}
					alt={post.data.title}
					class="w-full h-full object-cover group-hover:scale-105 transition duration-300"
					loading="lazy"
				/>
			</div>
		) : (
			<div class="aspect-video bg-slate-900 flex items-center justify-center">
				<svg class="w-12 h-12 text-blue-400 group-hover:scale-110 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
				</svg>
			</div>
		)}

		<div class="p-6">
			{showCategory && (
				<div class="flex items-center gap-2 mb-3">
					<span class="inline-block px-3 py-1 bg-blue-600/10 border border-slate-800 rounded-lg text-blue-400 text-xs font-semibold">
						{post.data.category}
					</span>
				</div>
			)}

			<h3 class="text-xl font-bold mb-3 group-hover:text-blue-400 transition line-clamp-2">
				{post.data.title}
			</h3>

			<p class="text-slate-400 text-sm mb-4 line-clamp-2">{post.data.description}</p>

			<div class="flex items-center justify-between text-xs text-slate-500 mb-4">
				<div class="flex items-center gap-4">
					<div class="flex items-center gap-1">
						<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
						</svg>
						<FormattedDate date={post.data.pubDate} short />
					</div>
					<div class="flex items-center gap-1">
						<svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
						</svg>
						<span>{readingTime} min read</span>
					</div>
				</div>
			</div>

			<span class="text-blue-400 font-semibold text-sm inline-flex items-center gap-2 group-hover:gap-3 transition-all">
				Read More
				<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
				</svg>
			</span>
		</div>
	</a>
</article>
